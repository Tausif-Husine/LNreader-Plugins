var e=this&&this.__awaiter||function(e,t,a,l){return new(a||(a=Promise))((function(r,n){function i(e){try{o(l.next(e))}catch(e){n(e)}}function s(e){try{o(l.throw(e))}catch(e){n(e)}}function o(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(i,s)}o((l=l.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var a,l,r,n={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(o){return function(s){if(a)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(n=0)),n;)try{if(a=1,l&&(r=2&s[0]?l.return:s[0]?l.throw||((r=l.return)&&r.call(l),0):l.next)&&!(r=r.call(l,s[1])).done)return r;switch(l=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return n.label++,{value:s[1],done:!1};case 5:n.label++,l=s[1],s=[0];continue;case 7:s=n.ops.pop(),n.trys.pop();continue;default:if(!(r=n.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){n=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){n.label=s[1];break}if(6===s[0]&&n.label<r[1]){n.label=r[1],r=s;break}if(r&&n.label<r[2]){n.label=r[2],n.ops.push(s);break}r[2]&&n.ops.pop(),n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e],l=0}finally{a=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}};Object.defineProperty(exports,"__esModule",{value:!0});var a=require("@libs/fetch"),l=require("@libs/filterInputs"),r=require("cheerio"),n=require("@libs/novelStatus"),i=function(){function i(){var e=this;this.id="mznovels",this.name="MzNovels",this.icon="src/en/mznovels/icon.png",this.site="https://mznovels.com",this.version="1.0.0",this.customUserAgent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36",this.filters={sort_by:{label:"Sort By",value:"views",type:l.FilterTypes.Picker,options:[{label:"Relevance",value:"relevance"},{label:"Date Updated",value:"date"},{label:"Number of Views",value:"views"},{label:"Number of Favorites",value:"favorites"},{label:"Number of Bookmarks",value:"bookmarks"}]},sort_order:{label:"Sort Order",value:"desc",type:l.FilterTypes.Picker,options:[{label:"Descending",value:"desc"},{label:"Ascending",value:"asc"}]},status_filter:{label:"Story Status",value:"all",type:l.FilterTypes.Picker,options:[{label:"All Statuses",value:"all"},{label:"Ongoing Only",value:"ongoing"},{label:"Completed Only",value:"completed"}]},story_origin:{label:"Story Origin",value:"all",type:l.FilterTypes.Picker,options:[{label:"All Origins",value:"all"},{label:"Original",value:"original"},{label:"Fanfiction",value:"fanfiction"}]},genre_logic:{label:"Genre Logic (for included)",value:"AND",type:l.FilterTypes.Picker,options:[{label:"AND",value:"AND"},{label:"OR",value:"OR"}]},genres:{label:"Genres",value:{included:[],excluded:[]},type:l.FilterTypes.ExcludableCheckboxGroup,options:[{label:"Action",value:"1"},{label:"Adult",value:"2"},{label:"Adventure",value:"3"},{label:"Comedy",value:"4"},{label:"Doujinshi",value:"5"},{label:"Drama",value:"6"},{label:"Ecchi",value:"7"},{label:"Fantasy",value:"8"},{label:"Gender Bender",value:"9"},{label:"Harem",value:"10"},{label:"Historical",value:"11"},{label:"Horror",value:"12"},{label:"Isekai",value:"13"},{label:"Josei",value:"14"},{label:"Martial Arts",value:"15"},{label:"Mecha",value:"16"},{label:"Mystery",value:"17"},{label:"Psychological",value:"18"},{label:"Romance",value:"19"},{label:"School Life",value:"20"},{label:"Sci-fi",value:"21"},{label:"Seinen",value:"22"},{label:"Shoujo",value:"23"},{label:"Shounen",value:"24"},{label:"Slice of Life",value:"25"},{label:"Smut",value:"26"},{label:"Sports",value:"27"},{label:"Supernatural",value:"28"},{label:"Tragedy",value:"29"},{label:"Yaoi",value:"30"},{label:"Yuri",value:"31"}]},story_type_logic:{label:"Content Logic",value:"OR",type:l.FilterTypes.Picker,options:[{label:"AND",value:"AND"},{label:"OR",value:"OR"}]},story_types:{label:"Content Warnings",value:[],type:l.FilterTypes.CheckboxGroup,options:[{label:"Gore",value:"1"},{label:"Sexuality violent",value:"2"},{label:"Mature",value:"3"},{label:"Strong language",value:"4"}]}},this.resolveUrl=function(t){return t.startsWith("http")?t:e.site+t}}return i.prototype.getRequestInit=function(){return{headers:{"User-Agent":this.customUserAgent}}},i.prototype.popularNovels=function(l,n){return e(this,arguments,void 0,(function(e,l){var n,i,s,o,u,c,v,h,p,b=this,f=l.showLatestNovels,d=l.filters;return t(this,(function(t){switch(t.label){case 0:return f&&(d.sort_by.value="date",d.sort_order.value="desc"),(n=new URL(this.site+"/advanced-search/")).searchParams.set("page",e.toString()),n.searchParams.set("sort_by",d.sort_by.value),n.searchParams.set("sort_order",d.sort_order.value),n.searchParams.set("status_filter",d.status_filter.value),n.searchParams.set("story_origin",d.story_origin.value),n.searchParams.set("genre_logic",d.genre_logic.value),n.searchParams.set("story_type_logic",d.story_type_logic.value),null===(c=null===(u=d.genres.value)||void 0===u?void 0:u.included)||void 0===c||c.forEach((function(e){return n.searchParams.append("genres",e)})),null===(h=null===(v=d.genres.value)||void 0===v?void 0:v.excluded)||void 0===h||h.forEach((function(e){return n.searchParams.append("exclude_genres",e)})),null===(p=d.story_types.value)||void 0===p||p.forEach((function(e){return n.searchParams.append("story_types",e)})),[4,(0,a.fetchApi)(n.toString(),this.getRequestInit())];case 1:return[4,t.sent().text()];case 2:return i=t.sent(),s=(0,r.load)(i),o=[],s("li.search-result-item").each((function(e,t){var a=s(t).find("a.search-result-title-link").attr("href");if(a){var l=s(t).find("h2.search-result-title").text().trim(),r=s(t).find("img.search-result-image").attr("src");r&&!r.startsWith("http")&&(r=b.site+r),o.push({name:l,path:a,cover:r})}})),[2,o]}}))}))},i.prototype.parseNovel=function(l){return e(this,void 0,void 0,(function(){var e,i,s,o,u,c,v,h,p,b,f,d,g,y,m,_,x,S;return t(this,(function(t){switch(t.label){case 0:return e=this.resolveUrl(l),[4,(0,a.fetchApi)(e,this.getRequestInit())];case 1:return[4,t.sent().text()];case 2:if(i=t.sent(),s=(0,r.load)(i),(o=s("img#novel-cover-image").attr("src"))&&(o=this.resolveUrl(o)),u={path:l,name:s("h1.novel-title").text().trim(),cover:o,summary:s(".summary-text").text().trim(),author:s(".novel-author a").text().trim()},c=[],s(".genres-container a.genre, .tags-container a.tag").each((function(e,t){c.push(s(t).text().trim())})),u.genres=c.join(", "),v=s(".novel-status .status-indicator").text().trim(),u.status="ongoing"===v.toLowerCase()?n.NovelStatus.Ongoing:"completed"===v.toLowerCase()?n.NovelStatus.Completed:n.NovelStatus.Unknown,h=[],(p=function(e){e("ul.chapter-list li.chapter-item").each((function(t,a){var l=e(a).find("a.chapter-link"),r=l.attr("href");if(r){var n=l.text().trim(),i=e(a).find("span.chapter-date").text().trim();h.push({name:n,path:r,releaseTime:i})}}))})(s),b=s('.pagination a:contains("Last")').attr("href"),f=1,b)try{d=new URLSearchParams(b.split("?")[1]),f=Number(d.get("page"))||1}catch(e){(g=b.match(/page=(\d+)/))&&(f=Number(g[1]))}else y=1,s('.pagination a[href*="page="]').each((function(e,t){var a=Number(s(t).text());!isNaN(a)&&a>y&&(y=a)})),f=y;m=2,t.label=3;case 3:return m<=f?(_="".concat(e,"?page=").concat(m),[4,(0,a.fetchApi)(_,this.getRequestInit())]):[3,7];case 4:return[4,t.sent().text()];case 5:x=t.sent(),S=(0,r.load)(x),p(S),t.label=6;case 6:return m++,[3,3];case 7:return u.chapters=h.reverse(),[2,u]}}))}))},i.prototype.parseChapter=function(l){return e(this,void 0,void 0,(function(){var e,n;return t(this,(function(t){switch(t.label){case 0:return[4,(0,a.fetchApi)(this.resolveUrl(l),this.getRequestInit())];case 1:return[4,t.sent().text()];case 2:return e=t.sent(),n=(0,r.load)(e),[2,n(".formatted-content").html()||""]}}))}))},i.prototype.searchNovels=function(l,n){return e(this,void 0,void 0,(function(){var e,i,s,o,u=this;return t(this,(function(t){switch(t.label){case 0:return e="".concat(this.site,"/search/?q=").concat(encodeURIComponent(l),"&page=").concat(n),[4,(0,a.fetchApi)(e,this.getRequestInit())];case 1:return[4,t.sent().text()];case 2:return i=t.sent(),s=(0,r.load)(i),o=[],s("li.search-result-item").each((function(e,t){var a=s(t).find("a.search-result-title-link").attr("href");if(a){var l=s(t).find("h2.search-result-title").text().trim(),r=s(t).find("img.search-result-image").attr("src");r&&!r.startsWith("http")&&(r=u.site+r),o.push({name:l,path:a,cover:r})}})),[2,o]}}))}))},i}();exports.default=new i;