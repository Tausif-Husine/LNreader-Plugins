var e=this&&this.__awaiter||function(e,t,a,r){return new(a||(a=Promise))((function(l,n){function o(e){try{s(r.next(e))}catch(e){n(e)}}function i(e){try{s(r.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?l(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,i)}s((r=r.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var a,r,l,n={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=i(0),o.throw=i(1),o.return=i(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(i){return function(s){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;o&&(o=0,i[0]&&(n=0)),n;)try{if(a=1,r&&(l=2&i[0]?r.return:i[0]?r.throw||((l=r.return)&&l.call(r),0):r.next)&&!(l=l.call(r,i[1])).done)return l;switch(r=0,l&&(i=[2&i[0],l.value]),i[0]){case 0:case 1:l=i;break;case 4:return n.label++,{value:i[1],done:!1};case 5:n.label++,r=i[1],i=[0];continue;case 7:i=n.ops.pop(),n.trys.pop();continue;default:if(!(l=n.trys,(l=l.length>0&&l[l.length-1])||6!==i[0]&&2!==i[0])){n=0;continue}if(3===i[0]&&(!l||i[1]>l[0]&&i[1]<l[3])){n.label=i[1];break}if(6===i[0]&&n.label<l[1]){n.label=l[1],l=i;break}if(l&&n.label<l[2]){n.label=l[2],n.ops.push(i);break}l[2]&&n.ops.pop(),n.trys.pop();continue}i=t.call(e,n)}catch(e){i=[6,e],r=0}finally{a=l=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("@libs/fetch"),l=require("@libs/filterInputs"),n=require("cheerio"),o=require("@libs/defaultCover"),i=require("@libs/novelStatus"),s=a(require("dayjs")),u=function(a){return e(void 0,void 0,void 0,(function(){var e,l,o;return t(this,(function(t){switch(t.label){case 0:return[4,(0,r.fetchText)(a)];case 1:if(e=t.sent(),l=(0,n.load)(e),!(o=l("div#app").attr("data-page")))throw new Error("Failed to find data-page attribute on ".concat(a));try{return[2,JSON.parse(o).props]}catch(e){throw new Error("Failed to parse JSON from data-page on ".concat(a,": ").concat(e))}return[2]}}))}))},c=function(e,t){return t?t.startsWith("//")?"https:"+t:t.startsWith("/")?e+t:t.startsWith("http")?t:o.defaultCover:o.defaultCover},v=[{label:"Action",value:"action"},{label:"Adult",value:"adult"},{label:"Adventure",value:"adventure"},{label:"Comedy",value:"comedy"},{label:"Drama",value:"drama"},{label:"Ecchi",value:"ecchi"},{label:"Fantasy",value:"fantasy"},{label:"Gender Bender",value:"gender-bender"},{label:"Harem",value:"harem"},{label:"Historical",value:"historical"},{label:"Horror",value:"horror"},{label:"Josei",value:"josei"},{label:"Martial Arts",value:"martial-arts"},{label:"Mature",value:"mature"},{label:"Mecha",value:"mecha"},{label:"Mystery",value:"mystery"},{label:"Psychological",value:"psychological"},{label:"Romance",value:"romance"},{label:"School Life",value:"school-life"},{label:"Sci-fi",value:"sci-fi"},{label:"Seinen",value:"seinen"},{label:"Shoujo",value:"shoujo"},{label:"Shoujo Ai",value:"shoujo-ai"},{label:"Shounen",value:"shounen"},{label:"Shounen Ai",value:"shounen-ai"},{label:"Slice of Life",value:"slice-of-life"},{label:"Smut",value:"smut"},{label:"Sports",value:"sports"},{label:"Supernatural",value:"supernatural"},{label:"Tragedy",value:"tragedy"},{label:"Wuxia",value:"wuxia"},{label:"Xianxia",value:"xianxia"},{label:"Xuanhuan",value:"xuanhuan"},{label:"Yaoi",value:"yaoi"},{label:"Yuri",value:"yuri"}],h=function(){function a(){var e=this;this.id="darkstartranslations",this.name="DarkStar Translations",this.icon="src/en/darkstartranslations/icon.png",this.site="https://brightnovels.com",this.version="1.0.3",this.filters={sortBy:{label:"Sort By",value:"updated|desc",options:[{label:"Recently Updated",value:"updated|desc"},{label:"A-Z",value:"title|asc"},{label:"Z-A",value:"title|desc"},{label:"Newest",value:"new|desc"},{label:"Oldest",value:"new|asc"}],type:l.FilterTypes.Picker},genres:{label:"Genres",value:[],options:v,type:l.FilterTypes.CheckboxGroup}},this.resolveUrl=function(t){return t.startsWith("http")?t:e.site+t},this.mapNovelStatus=function(e){switch(null==e?void 0:e.toLowerCase()){case"ongoing":return i.NovelStatus.Ongoing;case"completed":case"end":return i.NovelStatus.Completed;case"hiatus":return i.NovelStatus.OnHiatus;case"dropped":case"cancelled":return i.NovelStatus.Cancelled;default:return i.NovelStatus.Unknown}}}return a.prototype.popularNovels=function(a,r){return e(this,arguments,void 0,(function(e,a){var r,l,n,o,i,s,v,h,d,p,f,b,m,y=this,g=a.showLatestNovels,w=a.filters;return t(this,(function(t){switch(t.label){case 0:return r=[],l="",g?(l="".concat(this.site,"/series?order=desc&page=").concat(e,"&sort=new"),[4,u(l)]):[3,2];case 1:return v=t.sent(),(h=null===(d=v.seriesList)||void 0===d?void 0:d.data)&&Array.isArray(h)&&h.forEach((function(e){e.series_slug&&e.title&&r.push({name:e.title,path:"/series/".concat(e.series_slug),cover:c(y.site,e.coverImage)})})),[3,4];case 2:return l="".concat(this.site,"/series?"),n=w||this.filters,(null===(p=n.sortBy)||void 0===p?void 0:p.value)&&(o=n.sortBy.value.split("|"),i=o[0],s=o[1],l+="order=".concat(s,"&page=").concat(e,"&sort=").concat(i)),(null===(b=null===(f=n.genres)||void 0===f?void 0:f.value)||void 0===b?void 0:b.length)&&(l+="&genres=".concat(n.genres.value.join(","))),[4,u(l)];case 3:v=t.sent(),(h=null===(m=v.seriesList)||void 0===m?void 0:m.data)&&Array.isArray(h)&&h.forEach((function(e){var t,a;e.slug&&e.title&&r.push({name:e.title,path:"/series/".concat(e.slug),cover:c(y.site,(null===(t=e.cover)||void 0===t?void 0:t.thumbnail_url)||(null===(a=e.cover)||void 0===a?void 0:a.url)||e.coverImage)})})),t.label=4;case 4:return[2,r]}}))}))},a.prototype.parseNovel=function(a){return e(this,void 0,void 0,(function(){var e,l,o,i,v,h,d,p,f,b,m,y;return t(this,(function(t){switch(t.label){case 0:return[4,u(this.site+a)];case 1:if(e=t.sent(),!(l=e.series)||!l.slug)throw new Error("Failed to parse novel data or series slug for ".concat(a));return o={path:a,name:l.title||"Untitled",cover:c(this.site,(null===(p=l.cover)||void 0===p?void 0:p.url)||l.coverImage),summary:l.description?(0,n.load)(l.description).text():"",author:"DarkStarTL"===(null===(f=l.user)||void 0===f?void 0:f.name)||"GalaxyTL"===(null===(b=l.user)||void 0===b?void 0:b.name)?"DarkStar Translations":(null===(m=l.user)||void 0===m?void 0:m.name)||"Unknown",artist:null,status:this.mapNovelStatus(l.story_state),genres:(null===(y=l.genres)||void 0===y?void 0:y.map((function(e){return e.name})).join(", "))||""},i="".concat(this.site).concat(a,"/chapters?sort_order=desc"),[4,(0,r.fetchText)(i)];case 2:return v=t.sent(),h=JSON.parse(v),d=[],h&&h.chapters&&Array.isArray(h.chapters)&&h.chapters.forEach((function(e){if(e.slug&&(e.name||e.title||e.number)){var t=e.name||e.title||"Chapter ".concat(e.number);!0===e.is_premium&&(t="ðŸ”’ "+t),d.push({name:t,path:"/series/".concat(l.slug,"/").concat(e.slug),releaseTime:e.created_at?(0,s.default)(e.created_at).format("YYYY-MM-DD HH:mm"):null,chapterNumber:"number"==typeof e.number?e.number:void 0})}})),o.chapters=d.reverse(),[2,o]}}))}))},a.prototype.parseChapter=function(a){return e(this,void 0,void 0,(function(){var e,r,l;return t(this,(function(t){switch(t.label){case 0:return[4,u(this.site+a)];case 1:if(e=t.sent(),!(r=e.chapter)||!r.content)throw new Error("Failed to parse chapter content for ".concat(a));return(l=(0,n.load)(r.content))("div.ad-container").remove(),[2,l.html()]}}))}))},a.prototype.searchNovels=function(a,r){return e(this,void 0,void 0,(function(){var e,l,n,o,i,s=this;return t(this,(function(t){switch(t.label){case 0:return e="".concat(this.site,"/series?page=").concat(r,"&search=").concat(encodeURIComponent(a)),[4,u(e)];case 1:return l=t.sent(),n=[],(o=null===(i=l.seriesList)||void 0===i?void 0:i.data)&&Array.isArray(o)&&o.forEach((function(e){var t,a;e.slug&&e.title&&n.push({name:e.title,path:"/series/".concat(e.slug),cover:c(s.site,(null===(t=e.cover)||void 0===t?void 0:t.thumbnail_url)||(null===(a=e.cover)||void 0===a?void 0:a.url)||e.coverImage)})})),[2,n]}}))}))},a}();exports.default=new h;